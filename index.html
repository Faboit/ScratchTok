<!DOCTYPE html>

<html lang="en">

<head>

<meta charset="utf-8" />

<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />

<title>ScratchTok Ultra ‚Äî Personalized Feed</title>

<style>

:root {

--bg: #050505;

--accent: #ff0050;

--glass: rgba(255,255,255,0.15);

--text: #ffffff;

--panel: #1a1a1a;

--bottom-gradient: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);

}



body.theme-oled { --bg: #000000; --panel: #0a0a0a; --accent: #ff0050; }

body.theme-cyber { --bg: #0b0114; --panel: #1a0229; --accent: #00f2ea; }

body.theme-light { --bg: #f0f2f5; --panel: #ffffff; --accent: #ff0050; --text: #000000; --glass: rgba(0,0,0,0.1); --bottom-gradient: linear-gradient(0deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 100%); }



* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }



html, body {

height: 100%;

margin: 0;

background: var(--bg);

color: var(--text);

font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

overflow: hidden;

}



#feed {

height: 100vh;

overflow-y: scroll;

scroll-snap-type: y mandatory;

scrollbar-width: none;

scroll-behavior: smooth;

}

#feed::-webkit-scrollbar { display: none; }



.slide {

height: 100vh;

width: 100vw;

scroll-snap-align: start;

display: flex;

justify-content: center;

background: #000;

position: relative;

}



.project-container {

width: 100%;

height: 100%;

background: #111;

position: relative;

overflow: hidden;

display: flex;

align-items: center;

}



iframe { width: 100%; height: 100%; border: none; z-index: 1; }



/* Search Header - TikTok Style */

.search-container {

position: fixed;

top: 20px;

left: 50%;

transform: translateX(-50%);

z-index: 150;

width: 90%;

max-width: 450px;

}



.search-bar {

width: 100%;

background: var(--glass);

backdrop-filter: blur(25px);

border: 1px solid rgba(255,255,255,0.1);

border-radius: 30px;

padding: 12px 25px;

color: white;

outline: none;

font-size: 16px;

transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);

box-shadow: 0 4px 30px rgba(0,0,0,0.3);

}



.search-bar:focus {

background: rgba(255,255,255,0.25);

border-color: var(--accent);

box-shadow: 0 0 0 4px rgba(255, 0, 80, 0.2);

}



/* Overlays */

.info-overlay {

position: absolute;

bottom: 0;

left: 0;

width: 100%;

z-index: 10;

padding: 20px;

padding-bottom: 50px;

background: var(--bottom-gradient);

pointer-events: none;

transition: opacity 0.5s;

}

.info-overlay.faded { opacity: 0.3; }

.info-overlay:hover, .info-overlay.active { opacity: 1 !important; pointer-events: auto; }



.side-bar {

position: absolute;

right: 12px;

bottom: 120px;

z-index: 20;

display: flex;

flex-direction: column;

gap: 15px;

align-items: center;

}



.action-btn {

background: none;

border: none;

color: inherit;

cursor: pointer;

display: flex;

flex-direction: column;

align-items: center;

gap: 4px;

}



.icon-circle {

width: 48px;

height: 48px;

border-radius: 50%;

background: var(--glass);

display: grid;

place-items: center;

backdrop-filter: blur(10px);

font-size: 22px;

transition: transform 0.2s;

}

.action-btn:active .icon-circle { transform: scale(0.85); }

.action-btn.liked .icon-circle { color: var(--accent); }



.action-label { font-size: 12px; font-weight: 600; text-shadow: 0 1px 2px #000; color: #fff; }



.pfp { width: 40px; height: 40px; border-radius: 50%; border: 2px solid #fff; margin-bottom: 5px; }



.author-tag { font-size: 16px; font-weight: 700; color: #fff; text-decoration: none; }

.project-title { font-size: 14px; color: #eee; margin-top: 4px; max-width: 80%; }



#settings-btn {

position: fixed;

top: 25px;

left: 20px;

z-index: 200;

background: var(--glass);

border: none;

color: #fff;

width: 40px;

height: 40px;

border-radius: 50%;

cursor: pointer;

backdrop-filter: blur(10px);

}



.info-modal {

position: fixed;

bottom: 0;

left: 0;

width: 100%;

height: 70%;

background: var(--panel);

z-index: 400;

border-top-left-radius: 20px;

border-top-right-radius: 20px;

transform: translateY(100%);

transition: transform 0.3s ease-out;

padding: 25px;

overflow-y: auto;

}

.info-modal.active { transform: translateY(0); }



#loading-indicator {

position: fixed;

top: 80px;

left: 50%;

transform: translateX(-50%);

z-index: 140;

background: var(--accent);

padding: 5px 15px;

border-radius: 15px;

font-size: 12px;

color: #fff;

display: none;

}



.debug-info {

background: rgba(0,0,0,0.3);

padding: 10px;

border-radius: 8px;

font-family: monospace;

font-size: 11px;

margin-top: 20px;

border-left: 3px solid var(--accent);

}



.heart-pop {

position: absolute;

font-size: 100px;

pointer-events: none;

z-index: 1000;

animation: heart-anim 0.7s ease-out forwards;

}

@keyframes heart-anim {

0% { transform: scale(0) rotate(-20deg); opacity: 0; }

50% { transform: scale(1.2) rotate(10deg); opacity: 1; }

100% { transform: scale(1) rotate(0); opacity: 0; }

}

</style>

</head>

<body>



<button id="settings-btn" onclick="document.getElementById('settings-panel').style.display='flex'">‚öôÔ∏è</button>



<div class="search-container">

<input type="text" class="search-bar" placeholder="Search projects or user:name..." id="search-input" onkeydown="if(event.key==='Enter') handleSearch(this.value)">

</div>



<div id="loading-indicator">Updating feed...</div>



<div id="settings-panel" style="position:fixed; inset:0; background:var(--panel); z-index:500; display:none; flex-direction:column; padding:40px;">

<h1>Settings</h1>

<label>Interface Theme</label>

<select onchange="updateSetting('theme', this.value)" style="margin-bottom:20px; padding:10px;">

<option value="dark">Dark</option>

<option value="oled">OLED</option>

<option value="cyber">Cyber</option>

<option value="light">Light</option>

</select>

<div style="display:flex; justify-content:space-between;">

<label>Developer Mode</label>

<input type="checkbox" id="dev-check" onchange="updateSetting('devMode', this.checked)">

</div>

<button onclick="this.parentElement.style.display='none'" style="margin-top:auto; padding:15px; background:var(--accent); border:none; color:white; border-radius:10px;">Close</button>

</div>



<div id="info-modal" class="info-modal">

<div style="display:flex; justify-content:space-between; align-items:center;">

<h2 id="modal-title">Project Info</h2>

<button onclick="closeModal()" style="font-size:24px; background:none; border:none; color:inherit;">‚úï</button>

</div>

<div id="modal-body"></div>

</div>



<div id="feed"></div>



<script>

const state = {

activeId: null,

isFetching: false,

history: JSON.parse(localStorage.getItem('watched_history') || '{}'),

likes: JSON.parse(localStorage.getItem('liked_ids') || '{}'),

settings: JSON.parse(localStorage.getItem('user_settings') || '{"theme":"dark","devMode":false}'),

searchQuery: '',

userQuery: '',

offsets: { trending: 0, search: 0 }

};



async function apiRequest(url) {

// Scratch API blocks most browser requests via CORS.

// We must use a proxy to successfully fetch data in a browser environment.

try {

const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;

const response = await fetch(proxyUrl);

if (!response.ok) throw new Error('Proxy request failed');

const data = await response.json();

return JSON.parse(data.contents);

} catch (err) {

console.error("API Request Error:", err);

return null;

}

}



async function handleSearch(val) {

if (!val) return;

document.getElementById('loading-indicator').style.display = 'block';


// Reset state

document.getElementById('feed').innerHTML = '';

state.offsets = { trending: 0, search: 0 };


if (val.startsWith('user:')) {

state.userQuery = val.split(':')[1].trim();

state.searchQuery = '';

window.location.hash = `/user/${state.userQuery}`;

} else {

state.searchQuery = val;

state.userQuery = '';

window.location.hash = `/${val}`; // Will be handled as search if not numeric

}


await loadBatch();

document.getElementById('loading-indicator').style.display = 'none';

}



async function loadBatch() {

if (state.isFetching) return;

state.isFetching = true;



let url = `https://api.scratch.mit.edu/explore/projects?limit=15&offset=${state.offsets.trending}&mode=trending`;

let source = "Trending";



if (state.userQuery) {

url = `https://api.scratch.mit.edu/users/${state.userQuery}/projects?limit=15&offset=${state.offsets.search}`;

source = `User: ${state.userQuery}`;

} else if (state.searchQuery) {

url = `https://api.scratch.mit.edu/search/projects?q=${encodeURIComponent(state.searchQuery)}&limit=15&offset=${state.offsets.search}`;

source = `Search: ${state.searchQuery}`;

}



const projects = await apiRequest(url);

if (projects && Array.isArray(projects)) {

projects.forEach(p => {

p._source = source;

const slide = createSlide(p);

document.getElementById('feed').appendChild(slide);

observer.observe(slide);

});

state.offsets.trending += 15;

state.offsets.search += 15;

}

state.isFetching = false;

}



function createSlide(p) {

const s = document.createElement('div');

s.className = 'slide';

s.dataset.id = p.id;

s.dataset.raw = JSON.stringify({

title: p.title,

author: p.author?.username,

desc: p.description || '',

instr: p.instructions || '',

source: p._source,

id: p.id

});



const isLiked = state.likes[p.id];

const pfp = p.author ? `https://uploads.scratch.mit.edu/get_image/user/${p.author.id}_60x60.png` : '';



s.innerHTML = `

<div class="project-container" id="container-${p.id}">

<div class="info-overlay">

<div class="author-tag">@${p.author?.username || 'unknown'}</div>

<div class="project-title">${p.title}</div>

</div>

<div class="side-bar">

<img class="pfp" src="${pfp}" onerror="this.style.display='none'">

<button class="action-btn ${isLiked ? 'liked' : ''}" onclick="toggleLike(this, ${p.id})">

<div class="icon-circle">‚ù§Ô∏è</div>

<span class="action-label">Like</span>

</button>

<button class="action-btn" onclick="showInfo(${p.id})">

<div class="icon-circle">üìù</div>

<span class="action-label">Info</span>

</button>

</div>

</div>

`;



s.addEventListener('dblclick', (e) => {

spawnHeart(e);

const btn = s.querySelector('.action-btn');

if (!btn.classList.contains('liked')) toggleLike(btn, p.id);

});



return s;

}



function spawnHeart(e) {

const h = document.createElement('div');

h.className = 'heart-pop';

h.innerHTML = '‚ù§Ô∏è';

h.style.left = `${e.clientX - 50}px`;

h.style.top = `${e.clientY - 50}px`;

document.body.appendChild(h);

setTimeout(() => h.remove(), 700);

}



function toggleLike(btn, id) {

const liked = btn.classList.toggle('liked');

if (liked) state.likes[id] = true;

else delete state.likes[id];

localStorage.setItem('liked_ids', JSON.stringify(state.likes));

}



function showInfo(id) {

const slide = document.querySelector(`.slide[data-id="${id}"]`);

const data = JSON.parse(slide.dataset.raw);

const modal = document.getElementById('info-modal');

const body = document.getElementById('modal-body');


let debugHtml = '';

if (state.settings.devMode) {

debugHtml = `<div class="debug-info">DEBUG: id=${data.id} | src=${data.source}</div>`;

}



body.innerHTML = `

<h3>Instructions</h3><p>${data.instr || 'None'}</p>

<hr>

<h3>Notes</h3><p>${data.desc || 'None'}</p>

${debugHtml}

<div style="margin-top:20px; font-size:12px; color:#888;">Project ID: ${data.id} ‚Ä¢ ${data.source}</div>

`;

modal.classList.add('active');

}



function closeModal() { document.getElementById('info-modal').classList.remove('active'); }



function injectIframe(id) {

document.querySelectorAll('iframe').forEach(f => f.remove());

const container = document.getElementById(`container-${id}`);

const i = document.createElement('iframe');

i.src = `https://turbowarp.org/${id}/embed?autoplay=true&interpolate=true`;

i.allow = "fullscreen; autoplay";

container.appendChild(i);

state.activeId = id;

window.location.hash = `#/${id}`;

}



const observer = new IntersectionObserver((entries) => {

entries.forEach(e => {

if (e.isIntersecting && e.intersectionRatio > 0.6) {

const id = e.target.dataset.id;

if (state.activeId !== id) injectIframe(id);

}

});

}, { threshold: 0.7 });



document.getElementById('feed').onscroll = () => {

const f = document.getElementById('feed');

if (f.scrollTop + f.clientHeight > f.scrollHeight - 1000) loadBatch();

};



function updateSetting(key, val) {

state.settings[key] = val;

localStorage.setItem('user_settings', JSON.stringify(state.settings));

document.body.className = `theme-${state.settings.theme}`;

}



// Deep Linking & Initial Load

async function init() {

updateSetting('theme', state.settings.theme);

document.getElementById('dev-check').checked = state.settings.devMode;


const hash = window.location.hash.slice(2); // Remove #/

if (hash) {

if (!isNaN(hash)) {

// Jump to specific project

const p = await apiRequest(`https://api.scratch.mit.edu/projects/${hash}`);

if (p) {

const s = createSlide(p);

document.getElementById('feed').appendChild(s);

observer.observe(s);

}

} else if (hash.startsWith('user/')) {

handleSearch(`user:${hash.split('/')[1]}`);

return;

} else {

handleSearch(hash);

return;

}

}

loadBatch();

}



window.onload = init;

</script>

</body>

</html>
